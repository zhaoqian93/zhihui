<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>空调</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style1.css" />
    <style>
        html{
          background-color:#fff;
        }
        body{
          background-color:#fff;
        }

        .aui-grid{
          background-color: #fff;
        }

        .iconfont {
            font-size: 1.2rem;
        }

        .big_img {
            opacity: 0.6;
        }

        .c1 {
            color: #cf492e;
        }

        .c2 {
            color: #1296db;
        }

        .c3 {
            color: #4ba440;
        }

        .background {
            width: 100%;
            height: auto;
            background-color:	#fff;
            /*border: 1px solid black;*/
        }

        .tempbox {
            /*margin-top: 40px;*/
            font-size: 3rem;
            position: absolute;
            text-align: center;
            width: 100%;
            color: #DB5149;
        }

        .transbox {
            width: 100%;
            height: auto;
            /*margin-top: 140px;*/
            padding-left: 10px;
            background-color:	#fff;
            position: absolute;
            opacity: 0.8;
        }

        .enter {
            font-size: 2rem;
        }

        .switch0 {
            font-size: 2rem;
            color: #c1d2d7;
        }

        .switch1 {
            font-size: 2rem;
            color: #dc5a43; //dc5a43
        }

        .switch2 {
            font-size: 1.4rem;
            color: #dc5a43; //c1d2d7
        }

        .switch_plus {
            font-size: 1.6rem;
            color: #666666;
            margin-top: 0.2rem;
            display: block;
        }

        .p_title1 {
            height: 72px;
            line-height: 72px;
        }

        .aui-card-list-header,
        .aui-card-list-footer {
            min-height: 2.2rem;
            padding: 0.2rem 0.75rem;
        }

        /*.aui-grid [class*=aui-col-] {
            padding: 0.2rem 0;
        }*/

        /*.up .aui-col-xs-4 {
            height: 4.6rem;
        }*/
    </style>
</head>

<body>
    <div id="wrap" class="flex-wrap flex-vertical">
        <header class="aui-bar aui-bar-nav">
            <a class="aui-pull-left aui-btn" onclick="api.closeWin();">
                <span class="iconfont icon-fanhui2"></span>
            </a>
            <div class="aui-title title" id="sTitle">客厅空调</div>
            <a class="aui-pull-right aui-btn">
                <span class="iconfont icon-shezhi"></span>
            </a>
        </header>
        <div id="echarts1" style="width:100%;height:300px;">

        </div>
        <div id="main" class="flex-con">
            <div class="temperature">
              <div id="main1" style="width:100%;height:auto;"></div>
                <p id="" style="text-align:center;font-size:1.0rem;margin-top:2.0rem">制冷运行</p>
                <p id="sensus_wendu" style="text-align:center;font-size:2.0rem;font-weight:bold;">0</p>
                <section  class="aui-grid">
                    <div class="aui-row">
                      <div class="aui-col-xs-6">
                          <i class="iconfont c1 iconfont15 icon-shidu"></i>
                          <span id="sensus_shidu">0</span>
                      </div>
                      <div class="aui-col-xs-6">
                          <i class="iconfont c1 iconfont15 icon-daqiyali"></i>
                          <span id="sensus_daqiya">0</span>
                      </div>
                  </div>
                </section>

           </div>

            <section class="aui-grid ">
                <div class="aui-row">
                    <div class="aui-col-xs-4" onclick="addTemp()">
                        <i class="iconfont switch_plus icon-jian1" style="font-size:1.8rem"></i>
                        <div class="aui-grid-label">降温</div>
                    </div>
                    <div class="aui-col-xs-4" onclick="funSendDevice(517)">
                        <i class="iconfont switch1 icon-switch1"></i>
                        <div class="aui-grid-label">开关</div>
                    </div>
                    <div class="aui-col-xs-4" onclick="reduceTemp()">
                        <i class="iconfont switch_plus icon-jia" style="font-size:1.8rem"></i>
                        <div class="aui-grid-label">降温</div>
                    </div>
                </div>
            </section>
            <section class="aui-grid" >
                <div class="aui-row">
                    <div class="aui-col-xs-3" onclick="funSendDevice(517)">
                      <i class="iconfont iconfont20 c2 icon-canshu2" style="font-size:2.0rem;"></i>
                      <div class="aui-grid-label">参数</div>
                      <div class="header">
                      <ul class="nav">
                        <li><a><i class="iconfont icon-xia6" style="font-size:0.8rem;"></i></a>
                          <ul class="second-nav"></li>
                            <li><i class="iconfont c2 iconfont15 icon-48" style="float:left;margin-left:0.5rem"></i>
                                <span id="" style="margin-top:0.4rem">239.8V</span>
                            </li>
                            <li><i class="iconfont c2 iconfont15 icon-50" style="float:left;margin-left:0.5rem"></i>
                                <span id="" style="margin-top:0.4rem">5.1A</span>
                            </li>
                            <li><i class="iconfont c2 iconfont15 icon-47" style="float:left;margin-left:0.5rem"></i>
                                <span id="" style="margin-top:0.4rem">1120W</span>
                            </li>
                            <li><i class="iconfont c2 iconfont15 icon-gongshuaiyinshu" style="float:left;margin-left:0.5rem"></i>
                                <span id="" style="margin-top:0.4rem">0.998</span>
                            </li>
                          </ul></li>
                        </ul>
                      </div>
                    </div>

                    <div class="aui-col-xs-3" onclick="">
                        <i class="iconfont iconfont20 c2 icon-moshi-weixuanzhong-" style="font-size:2.0rem;"></i>
                        <div class="aui-grid-label">模式</div>
                        <div class="header">
                        <ul class="nav">
                          <li><a><i class="iconfont icon-xia6" style="font-size:0.8rem;"></i></a>
                            <ul class="second-nav"></li>
                              <li>
                                <div onclick="funSendDevice(521)">
                                   <i class="iconfont c2 iconfont15 icon-zhileng"></i>
                                   <span>制冷</span>
                                </div>
                              </li>
                              <li><div onclick="funSendDevice(550)">
                                 <i class="iconfont c2 iconfont15 icon-zhire"></i>
                                 <span>制热</span>
                              </div></li>
                              <li><div onclick="funSendDevice(519)">
                                 <i class="iconfont c2 iconfont15 icon-chushi"></i>
                                 <span>除湿</span>
                              </div></li>
                              <li><div onclick="funSendDevice(518)">
                                 <i class="iconfont c2 iconfont15 icon-tongfeng"></i>
                                 <span>通风</span>
                              </div></li>
                            </ul></li>
                          </ul>
                        </div>
                    </div>

                    <div class="aui-col-xs-3" onclick="funSendDevice(550)">
                        <i class="iconfont iconfont20 c2 icon-fengsu" style="font-size:2.0rem;"></i>
                        <div class="aui-grid-label">风速</div>
                    </div>

                    <div class="aui-col-xs-3" onclick="funSendDevice(519)">
                        <i class="iconfont iconfont20 c2 icon-icon05" style="font-size:2.0rem;"></i>
                        <div class="aui-grid-label">上下风</div>
                    </div>
                </div>
            </section>

        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/config.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../echarts/dist/echarts.min.js"></script>
<script type="text/javascript" src="../../script/jquery.min.js"></script>
<script type="text/javascript" src="../../script/echarts.min.js"></script>





<script type="text/javascript">
    apiready = function() {


        //getStatus();

        setInterval(function() {
            //getStatus();
        }, 5000);



    }


    function getStatus() {


        //通道状态 channel/status
        api.ajax({
            url: post_url + "channel/status",
            method: 'post',
            data: {
                values: {
                    status: 1
                }
            },

            headers: {
                'Authorization': 'Bearer ' + $api.getStorage('access_token')
            },
        }, function(ret, err) {
            if (ret) {

                if (ret.code == 200) {
                    var data = ret.data.lists;
                    //console.log(JSON.stringify(data));
                    var text = $api.text($api.byId('doT_list2'));
                    var evalText = doT.template(text);
                    $api.html($api.byId('item_list2'), evalText(data));
                }

            } else {
                //toLogin2();
            }
        });
    }
</script>

<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('echarts1'));

    // 指定图表的配置项和数据
    var option = {
    tooltip : {
        formatter: "{a} <br/>{b} : {c}%"
    },
    toolbox: {
        feature: {
            restore: {},
            saveAsImage: {}
        }
    },
    series: [
        {
          name: '速度',
            type: 'gauge',
            z: 3,
            min: 0,
            max: 220,
            splitNumber: 11,
            radius: '50%',
            axisLine: {            // 坐标轴线
                lineStyle: {       // 属性lineStyle控制线条样式
                    width: 10
                }
            },
            axisTick: {            // 坐标轴小标记
                length: 15,        // 属性length控制线长
                lineStyle: {       // 属性lineStyle控制线条样式
                    color: 'auto'
                }
            },
            splitLine: {           // 分隔线
                length: 20,         // 属性length控制线长
                lineStyle: {       // 属性lineStyle（详见lineStyle）控制线条样式
                    color: 'auto'
                }
            },
            axisLabel: {
                backgroundColor: 'auto',
                borderRadius: 2,
                color: '#eee',
                padding: 3,
                textShadowBlur: 2,
                textShadowOffsetX: 1,
                textShadowOffsetY: 1,
                textShadowColor: '#222'
            },
            title : {
                // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                fontWeight: 'bolder',
                fontSize: 20,
                fontStyle: 'italic'
            },
            detail : {
                // 其余属性默认使用全局文本样式，详见TEXTSTYLE
                formatter: function (value) {
                    value = (value + '').split('.');
                    value.length < 2 && (value.push('00'));
                    return ('00' + value[0]).slice(-2)
                        + '.' + (value[1] + '00').slice(0, 2);
                },
                fontWeight: 'bolder',
                borderRadius: 3,
                backgroundColor: '#444',
                borderColor: '#aaa',
                shadowBlur: 5,
                shadowColor: '#333',
                shadowOffsetX: 0,
                shadowOffsetY: 3,
                borderWidth: 2,
                textBorderColor: '#000',
                textBorderWidth: 2,
                textShadowBlur: 2,
                textShadowColor: '#fff',
                textShadowOffsetX: 0,
                textShadowOffsetY: 0,
                fontFamily: 'Arial',
                width: 100,
                color: '#eee',
                rich: {}
            },
            data:[{value: 40, name: 'km/h'}]
        },
    ]
};

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
</script>

<script type="text/javascript">
	$(function(){
		var _this1=null;
		$('.nav>li').hover(function(){
			_this1=$(this);
			_this1.find('.second-nav').show();
			var _this2=null;
			_this1.find('.second-nav').find('li').hover(function(){
				_this2=$(this);
				_this2.find('.third-nav').show();
				_this2.find('.third-nav').hover(function(){
					$(this).show();
				},function(){
					$(this).hide();
				});
			},function(){
				_this2.find('.third-nav').hide();
			});
		},function(){
			_this1.find('.second-nav').hide();
		});
	});
</script>
<script type="text/javascript">
    apiready = function() {
        fix_android_ios('black');
        $api.dom('#sTitle').innerHTML = api.pageParam.name;
        getData();

        connectSocket();
        //console.log(api.pageParam.id);
    };

    //夏天 默认启动制冷 20度
    //冬天 默认启动制热 26度

    var dev_id = api.pageParam.id;
    var temp_min = 16;
    var temp_max = 30;

    var temp_cur = 20;


    var air_mode = 1;

    function addTemp(){
      if(temp_cur>temp_max){
        return false;
      }
      temp_cur++;
      var send_data = ' { "device":"6100", "action":"conditioner", "user_id":1, "device_id":'+ dev_id +' , "mode":'+air_mode+' , "temp": '+temp_cur+'}';
      ws.send(send_data);
    }

    function reduceTemp(){
      if(temp_cur>temp_min){
      }
      temp_cur--;
      var send_data = ' { "device":"6100", "action":"conditioner", "user_id":1, "device_id":'+ dev_id +' , "mode":'+air_mode+' , "temp": '+temp_cur+'}';
      ws.send(send_data);
    }




    function onSocketMessage(e) {
        var obj = eval('(' + e.data + ')');
        //console.log(JSON.stringify(obj));
        return true;
        //alert([e.data,obj.status])

    }


    function funSendDevice(code) {

        //{ "device":"6100", "action":"conditioner", "user_id":123, "device_id":22 , "mode":1 , "temp": 16}
        var send_data = ' { "device":"6100", "action":"tv", "user_id":1, "device_id":' + dev_id + ' , "code": ' + code + '} ';
        ws.send(send_data);
    }


    function getData() {
        api.ajax({
            url: post_url + "sensus/show",
            method: 'post',
            data: {
                values: {
                    dev_id: dev_id
                }
            },
            headers: {
                'Authorization': 'Bearer ' + $api.getStorage('access_token')
            },
        }, function(ret, err) {
            if (ret) {

                //console.log(JSON.stringify(ret));
                //console.log(ret.data.size);
                var data = ret.data.lists[0];
                //console.log(JSON.stringify(data));
                //$api.html($api.byId('sTitle'), data.name);


                $api.html($api.byId('sensus_wendu'), data.wendu + unit_temp);
                $api.html($api.byId('sensus_shidu'), data.shidu + unit_shidu);
                $api.html($api.byId('sensus_daqiya'), data.daqiya + unit_daqiya);

            } else {
                console.log(JSON.stringify(err));
            }
        });
    }
</script>
